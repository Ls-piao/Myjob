(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/orderDetails/orderDetails"],{"1fb0":function(e,t,o){"use strict";var r,a=function(){var e=this,t=e.$createElement;e._self._c},n=[];o.d(t,"b",function(){return a}),o.d(t,"c",function(){return n}),o.d(t,"a",function(){return r})},"2e1c":function(e,t,o){"use strict";(function(e,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(o("a34a"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t,o,r,a,n,i){try{var s=e[n](i),d=s.value}catch(l){return void o(l)}s.done?t(d):Promise.resolve(d).then(r,a)}function s(e){return function(){var t=this,o=arguments;return new Promise(function(r,a){var n=e.apply(t,o);function s(e){i(n,r,a,s,d,"next",e)}function d(e){i(n,r,a,s,d,"throw",e)}s(void 0)})}}var d=function(){return o.e("components/evan-steps/evan-steps").then(o.bind(null,"c017"))},l=function(){return o.e("components/evan-steps/evan-step").then(o.bind(null,"8218"))},c=function(){return Promise.all([o.e("common/vendor"),o.e("components/uni-icons/uni-icons")]).then(o.bind(null,"f4d2"))},u=function(){return Promise.all([o.e("common/vendor"),o.e("components/evan-icons/evan-icons")]).then(o.bind(null,"f92c"))},f={components:{EvanSteps:d,EvanStep:l,UniIcons:c,EvanIcons:u},onLoad:function(t){var o=this;this.phone=e.getStorageSync("phone"),console.log(r(this.phone," at pages\\orderDetails\\orderDetails.vue:87")),this.orderid=Number(t.orderid),console.log(r(this.orderid," at pages\\orderDetails\\orderDetails.vue:89")),e.request({url:this.$bashUrl+"/index.php/home/Api/my_order_info/",method:"POST",data:{good_id:this.orderid},success:function(t){if(console.log(r(t," at pages\\orderDetails\\orderDetails.vue:97")),o.orderList=t.data.infos,0==o.orderList.orderid?o.orderId=o.randomOrder(0):o.orderId=Number(o.orderList.orderid),o.storephone=t.data.store_phone,o.name=t.data.store_name,o.goodList=t.data.infos.goods.split(","),o.goodList.pop(),console.log(r(o.goodList," at pages\\orderDetails\\orderDetails.vue:108")),e.request({url:o.$bashUrl+"/index.php/home/Api/table_names/",method:"POST",data:{id:Number(o.orderList.table_id)},success:function(e){console.log(r(e," at pages\\orderDetails\\orderDetails.vue:116")),o.tablename=e.data[0].table_name},fail:function(e){console.log(r(e," at pages\\orderDetails\\orderDetails.vue:120"))}}),0==o.orderList.pay_state&&0==o.orderList.state){o.waiState=0;var a=o.orderList.intime.replace(/-/g,"/");console.log(r(a-1," at pages\\orderDetails\\orderDetails.vue:126"));var n=new Date(a).getTime()+3e5,i=(new Date).getTime(),s=n-i;console.log(r(n," at pages\\orderDetails\\orderDetails.vue:131")),console.log(r(i," at pages\\orderDetails\\orderDetails.vue:132")),console.log(r(s," at pages\\orderDetails\\orderDetails.vue:133")),s<=0?(e.showToast({title:"订单已超时",icon:"none"}),setTimeout(function(){e.request({url:o.$bashUrl+"/index.php/home/Api/cancel_apriont",method:"post",data:{id:o.orderList.id},success:function(t){console.log(r(t," at pages\\orderDetails\\orderDetails.vue:147")),e.showToast({title:"已取消预约"}),e.navigateBack({delta:1})},fail:function(e){}})},1e3)):o.deTime(s,o.orderList.id)}else 0==o.orderList.pay_state&&1==o.orderList.state?o.waiState=1:0==o.orderList.pay_state||(0==o.orderList.state?o.waiState=2:o.waiState=3)}})},methods:{requestPayment:function(){var t=s(a.default.mark(function t(o,n){var i,s,d,l,c,u,f=this;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this,0==parseFloat(this.zprice)||0==parseFloat(this.zprice)){t.next=21;break}return console.log(r("正在支付"," at pages\\orderDetails\\orderDetails.vue:193")),e.showLoading({title:"正在支付..."}),i="",i=this.orderId,console.log(r(i," at pages\\orderDetails\\orderDetails.vue:201")),s=this.zprice,d="莫等闲-预定支付",t.next=11,this.getOrderInfo(i,s,d);case 11:if(l=t.sent,l.appid){t.next=16;break}return e.showToast({title:"支付信息有误",icon:"none"}),e.hideLoading(),t.abrupt("return",!1);case 16:c={appid:l.appid,partnerid:l.partnerid,prepayid:l.prepayid,package:"Sign=WXPay",noncestr:l.noncestr,timestamp:l.timestamp,sign:l.sign},u=JSON.stringify(c),e.requestPayment({provider:"wxpay",orderInfo:u,success:function(t){e.request({url:f.$bashUrl+"/index.php/home/Api/user_order/",method:"POST",data:{id:f.orderid,price:parseInt(f.orderList.money),goods:f.orderList.goods_id},success:function(t){e.showToast({title:"支付成功!",icon:"none"}),e.hideLoading(),setTimeout(function(){e.switchTab({url:"/pages/reserve/reserve"})},2e3)},fail:function(t){e.hideLoading(),console.log(r(t," at pages\\orderDetails\\orderDetails.vue:257"))}})},fail:function(t){e.hideLoading()},complete:function(){e.switchTab({url:"pages/reserve/reserve"})}}),t.next=22;break;case 21:e.showToast({title:"订单不能为空",icon:"none"});case 22:case"end":return t.stop()}},t,this)}));function o(e,o){return t.apply(this,arguments)}return o}(),randomOrder:function(e){for(var t=0;t<6;t++)e+=Math.floor(10*Math.random());return(new Date).getTime()+e},getOrderInfo:function(t,o,a){var n=this;console.log(r("============================="," at pages\\orderDetails\\orderDetails.vue:286")),console.log(r(t," at pages\\orderDetails\\orderDetails.vue:287")),console.log(r("============================="," at pages\\orderDetails\\orderDetails.vue:288"));var i=this.orderList.goods_id.split(","),s="https://ww.0816fc.net/index.php/home/Pay/pay";return console.log(r(this.orderid," at pages\\orderDetails\\orderDetails.vue:296")),new Promise(function(o){e.request({url:s,method:"POST",data:{id:n.orderid,orderId:t,body:a,price:parseInt(n.orderList.money),goods:i},success:function(e){console.log(r(e," at pages\\orderDetails\\orderDetails.vue:309")),o(e.data)},fail:function(e){console.log(r(e," at pages\\orderDetails\\orderDetails.vue:313")),o(e)}})})},toShop:function(e){},toPay:function(){},refund:function(t){var o=this;e.showModal({title:"取消并申请退款",content:"申请退款联系客服人员 加wx:sjrfsjz",confirmText:"确认",success:function(a){a.confirm&&(e.request({url:o.$bashUrl+"/index.php/home/Api/cancel_apriont",method:"post",data:{id:t},success:function(t){console.log(r(t," at pages\\orderDetails\\orderDetails.vue:339")),e.showToast({title:"已取消预约"}),e.navigateBack({delta:1})},fail:function(e){}}),e.navigateBack({delta:1}))}})},deTime:function(t,o){var a=this,n=setInterval(function(){t-=1e3;var i=(Math.floor(t/1e3/60)+"").padStart(2,"0")+":"+(Math.floor(t/1e3%60)+"").padStart(2,"0");a.time=i,a.time<0&&(clearInterval(n),e.request({url:a.$bashUrl+"/index.php/home/Api/cancel_apriont",method:"post",data:{id:o},success:function(t){console.log(r(t," at pages\\orderDetails\\orderDetails.vue:372")),e.showToast({title:"已取消预约"}),e.navigateBack({delta:1})},fail:function(e){}}))},1e3)}},data:function(){return{phone:0,tablename:"",orderList:[],goodList:[],orderid:0,name:"",waiState:1,time:"05:00",storephone:"",orderId:0}}};t.default=f}).call(this,o("6e42")["default"],o("0de9")["default"])},"426f":function(e,t,o){"use strict";o.r(t);var r=o("2e1c"),a=o.n(r);for(var n in r)"default"!==n&&function(e){o.d(t,e,function(){return r[e]})}(n);t["default"]=a.a},"9f89":function(e,t,o){"use strict";(function(e){o("c2bf"),o("921b");r(o("66fd"));var t=r(o("ff67"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])},a4c4:function(e,t,o){},c7fe:function(e,t,o){"use strict";var r=o("a4c4"),a=o.n(r);a.a},ff67:function(e,t,o){"use strict";o.r(t);var r=o("1fb0"),a=o("426f");for(var n in a)"default"!==n&&function(e){o.d(t,e,function(){return a[e]})}(n);o("c7fe");var i,s=o("f0c5"),d=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,"f99ae3ce",null,!1,r["a"],i);t["default"]=d.exports}},[["9f89","common/runtime","common/vendor"]]]);