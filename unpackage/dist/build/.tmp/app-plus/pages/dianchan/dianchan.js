(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/dianchan/dianchan"],{1685:function(t,i,n){"use strict";n.r(i);var e=n("58fe"),a=n("d9f9");for(var r in a)"default"!==r&&function(t){n.d(i,t,function(){return a[t]})}(r);n("f2b1");var o,s=n("f0c5"),u=Object(s["a"])(a["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],o);i["default"]=u.exports},4269:function(t,i,n){},"58fe":function(t,i,n){"use strict";var e,a=function(){var t=this,i=t.$createElement;t._self._c},r=[];n.d(i,"b",function(){return a}),n.d(i,"c",function(){return r}),n.d(i,"a",function(){return e})},"6d9d":function(t,i,n){"use strict";(function(t){n("c2bf"),n("921b");e(n("66fd"));var i=e(n("1685"));function e(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,n("6e42")["createPage"])},d9f9:function(t,i,n){"use strict";n.r(i);var e=n("e930"),a=n.n(e);for(var r in e)"default"!==r&&function(t){n.d(i,t,function(){return e[t]})}(r);i["default"]=a.a},e930:function(t,i,n){"use strict";(function(t,e){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var a=r(n("a34a"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t,i,n,e,a,r,o){try{var s=t[r](o),u=s.value}catch(c){return void n(c)}s.done?i(u):Promise.resolve(u).then(e,a)}function s(t){return function(){var i=this,n=arguments;return new Promise(function(e,a){var r=t.apply(i,n);function s(t){o(r,e,a,s,u,"next",t)}function u(t){o(r,e,a,s,u,"throw",t)}s(void 0)})}}var u={data:function(){return{rightListSum:[],showShoppingCart:!0,shoppingCartAnimation:!1,shoppingCarz:0,showBall:!1,animationY:"",animationX:"",ballY:"",ballX:"",leftNav:[],rightNav:[],curListIndex:0,mainCur:0,listHeight:[],scrollY:"",Did:"",Tid:0,imgUrl:"",zprice:0,goodsList:[],order_id:0,providerList:[],loading:!1,dddd:""}},onLoad:function(i){var n=this;console.log(t("开始"," at pages\\dianchan\\dianchan.vue:148")),e.getProvider({service:"payment",success:function(i){console.log(t("payment success:"+JSON.stringify(i)," at pages\\dianchan\\dianchan.vue:152"));var e=[];i.provider.map(function(t){switch(t){case"wxpay":e.push({name:"微信",id:t,loading:!1});break;default:break}}),n.providerList=e,console.log(t(n.providerList," at pages\\dianchan\\dianchan.vue:168"))},fail:function(i){console.log(t("获取支付通道失败：",i," at pages\\dianchan\\dianchan.vue:171"))}}),this.order_id=i.orderid,this.imgUrl=this.$imgUrl,this.Did=i.aid,console.log(t(this.Did," at pages\\dianchan\\dianchan.vue:177")),this.calculateHeight();var a=this;e.request({url:this.$bashUrl+"/index.php/home/Api/store_menu/",method:"POST",data:{id:this.Did},success:function(i){console.log(t(i," at pages\\dianchan\\dianchan.vue:189")),a.rightNav=i.data.goods,a.leftNav=i.data.type;for(var n=[],e=0;e<a.rightNav.length;e++){var r={showDel:!1,delAnimation:!1,sum:0};n.push(r)}a.rightListSum=n}})},methods:{toPay:function(){e.navigateTo({url:"../count/count?order_id="+this.order_id+"&goodslist="+this.goodsList+"&price="+this.zprice})},requestPayment:function(){var i=s(a.default.mark(function i(n,r){var o,s,u,c,d,h,l=this;return a.default.wrap(function(i){while(1)switch(i.prev=i.next){case 0:if(this,console.log(t(parseFloat(this.zprice)," at pages\\dianchan\\dianchan.vue:215")),0==parseFloat(this.zprice)||0==parseFloat(this.zprice)){i.next=24;break}return console.log(t("正在支付"," at pages\\dianchan\\dianchan.vue:217")),e.showLoading({title:"正在支付..."}),this.providerList[r].loading=!0,o="",o=this.randomOrder(o),console.log(t(o," at pages\\dianchan\\dianchan.vue:226")),s=this.zprice,u="莫等闲-预定支付",i.next=13,this.getOrderInfo(o,s,u);case 13:if(c=i.sent,console.log(t(c," at pages\\dianchan\\dianchan.vue:230")),c.appid){i.next=19;break}return e.showToast({title:"支付信息有误",icon:"none"}),e.hideLoading(),i.abrupt("return",!1);case 19:d={appid:c.appid,partnerid:c.partnerid,prepayid:c.prepayid,package:"Sign=WXPay",noncestr:c.noncestr,timestamp:c.timestamp,sign:c.sign},h=JSON.stringify(d),e.requestPayment({provider:"wxpay",orderInfo:h,success:function(i){e.request({url:l.$bashUrl+"/index.php/home/Api/user_order/",method:"POST",data:{id:l.order_id,price:l.zprice,goods:l.goodsList,pay_state:1},success:function(t){e.showToast({title:"支付成功!",icon:"none"}),e.hideLoading(),setTimeout(function(){e.switchTab({url:"/pages/reserve/reserve"})},2e3)},fail:function(i){e.hideLoading(),console.log(t(i," at pages\\dianchan\\dianchan.vue:282"))}})},fail:function(t){e.hideLoading()},complete:function(){l.providerList[r].loading=!1}}),i.next=25;break;case 24:e.showToast({title:"订单不能为空",icon:"none"});case 25:case"end":return i.stop()}},i,this)}));function n(t,n){return i.apply(this,arguments)}return n}(),randomOrder:function(t){for(var i=0;i<6;i++)t+=Math.floor(10*Math.random());return(new Date).getTime()+t},getOrderInfo:function(t,i,n){var a=this,r="https://ww.0816fc.net/index.php/home/Pay/pay";return new Promise(function(o){e.request({url:r,method:"POST",data:{id:a.order_id,orderId:t,body:n,price:i,goods:a.goodsList},success:function(t){o(t.data)},fail:function(t){o(t)}})})},delShoppingCard:function(){var t=s(a.default.mark(function t(i){var n=this;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.rightListSum[i].sum-1<=0?(this.rightListSum[i].sum=this.rightListSum[i].sum-1,this.rightListSum[i].delAnimation=!1,this.setDelayTime(100).then(function(){n.rightListSum[i].showDel=!1})):this.rightListSum[i].sum=this.rightListSum[i].sum-1;case 1:case"end":return t.stop()}},t,this)}));function i(i){return t.apply(this,arguments)}return i}(),addShoppingCard:function(i){var n=i.currentTarget.dataset.index;this.goodsList.push(this.rightNav[n].id),this.rightListSum[n].sum=this.rightListSum[n].sum+1,this.rightListSum[n].delAnimation=!0,this.rightListSum[n].showDel=!0;var e=i.detail.x,a=i.detail.y;this.createAnimation(e,a),this.shoppingCarz++,console.log(t(" at pages\\dianchan\\dianchan.vue:360")),this.zprice=(parseFloat(this.zprice)+parseFloat(this.rightNav[n].price)).toFixed(2)},setDelayTime:function(t){return new Promise(function(i,n){setTimeout(function(){i()},t)})},createAnimation:function(t,i){var n=this;e.getSystemInfo({success:function(){var e=s(a.default.mark(function e(r){var o,s,u,c;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o=50,s=r.windowHeight-50,u=n.flyX(o,t),c=n.flyY(s,i),n.ballX=t,n.ballY=i,n.showBall=!0,n.setDelayTime(100).then(function(){return n.animationX=u.export(),n.animationY=c.export(),n.setDelayTime(400)}).then(function(){return n.animationX=n.flyX(0,0,0).export(),n.animationY=n.flyY(0,0,0).export(),n.showBall=!1,n.shoppingCartAnimation=!0,n.setDelayTime(400)}).then(function(){n.shoppingCartAnimation=!1});case 8:case"end":return e.stop()}},e,this)}));function r(t){return e.apply(this,arguments)}return r}()})},flyX:function(t,i,n){var a=e.createAnimation({duration:n||400,timingFunction:"linear"});return a.translateX(t-i).step(),a},flyY:function(t,i,n){var a=e.createAnimation({duration:n||400,timingFunction:"ease-in"});return a.translateY(t-i).step(),a},noScroll:function(t){if(this.scrollY=t.detail.scrollTop+20,this.scrollY<0)return this.curListIndex=0,!0;for(var i=0;i<this.listHeight.length-1;i++){var n=this.listHeight[i];this.scrollY>n.start&&this.scrollY<n.end&&(this.curListIndex=i)}},goAnchor:function(i,n){console.log(t(i," at pages\\dianchan\\dianchan.vue:455")),this.curListIndex=i,this.mainCur="order"+n},calculateHeight:function(){for(var t=this,i=this.rightNav,n=0,a=0;a<i.length;a++){var r=e.createSelectorQuery().in(this);r.select("#main-"+a).boundingClientRect(function(i){var e={};e.start=n,n+=i.height,e.end=n,t.listHeight.push(e)}).exec();var o={showDel:!1,delAnimation:!1,sum:0};this.rightListSum.push(o)}},sign:function(t){}}};i.default=u}).call(this,n("0de9")["default"],n("6e42")["default"])},f2b1:function(t,i,n){"use strict";var e=n("4269"),a=n.n(e);a.a}},[["6d9d","common/runtime","common/vendor"]]]);